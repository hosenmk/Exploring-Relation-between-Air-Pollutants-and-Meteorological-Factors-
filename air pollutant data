import pandas as pd
import numpy as np
import statsmodels.api as sm
from sklearn.model_selection import train_test_split
from sklearn.metrics import r2_score
import matplotlib.pyplot as plt
import seaborn as sns
from scipy import stats
from scipy.stats import norm
from sklearn.linear_model import Ridge
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import mean_squared_error, r2_score
from sklearn.linear_model import ElasticNet
from sklearn.cross_decomposition import PLSRegression
from sklearn.decomposition import PCA
from sklearn.metrics import r2_score

# Step 1: Load and prepare your dataset
# Assuming you have a CSV file named 'data.csv'
data = pd.read_csv('AQI Compiled Data csv.csv')
data.head()

# Splitting into independent variables (X) and dependent variables (Y)
X = data[['Precipitation (mm/d)', 'Specific Humidity (Mass fraction)',
       'Temperature (k)', 'Wind_f_inst (m/s)', 'Air Pressure (Pa)']]
Y = data[['CO column number density (micromole/m^2)', 'NO2 column number density (micromole/m^2)',
       'SO2 column number density (micromole/m^2)',
       'O3 column number density (micromole/m^2)', 'Optical Depth 047']]

# Plot histograms for each variable
plt.figure(figsize=(10, 6))
plt.hist(X['Precipitation (mm/d)'], bins=30, alpha=0.5, label='Precipitation')
plt.title('Histogram of a Single Variable')
plt.xlabel('Values')
plt.ylabel('Frequency')
plt.grid(True)
plt.show()

# Plot histograms for each variable
plt.figure(figsize=(10, 6))
plt.hist(X['Specific Humidity (Mass fraction)'], bins=30, alpha=0.5, label='Specific Humidity (Mass fraction)')
plt.title('Histogram of Specific Humidity')
plt.xlabel('Values')
plt.ylabel('Frequency')
plt.grid(True)
plt.show()


# Plot histograms for each variable
plt.figure(figsize=(10, 6))
plt.hist(X['Temperature (k)'], bins=30, alpha=0.5, label='Temperature (k)')
plt.title('Histogram of Temperature (k)')
plt.xlabel('Values')
plt.ylabel('Frequency')
plt.grid(True)
plt.show()

# Plot histograms for each variable
plt.figure(figsize=(10, 6))
plt.hist(X['Wind_f_inst (m/s)'], bins=30, alpha=0.5, label='Wind_f_inst (m/s)')
plt.title('Histogram of Wind_f_inst (m/s)')
plt.xlabel('Values')
plt.ylabel('Frequency')
plt.grid(True)
plt.show()

# Plot histograms for each variable
plt.figure(figsize=(10, 6))
plt.hist(X['Air Pressure (Pa)'], bins=30, alpha=0.5, label='Air Pressure (Pa)')
plt.title('Histogram of a Air Pressure (Pa)')
plt.xlabel('Values')
plt.ylabel('Frequency')
plt.grid(True)
plt.show()

# Perform Shapiro-Wilk test
statistic, p_value = stats.shapiro(X['Precipitation (mm/d)'])

# Print the results
print("Shapiro-Wilk Test:")
print(f"Test Statistic: {statistic}")
print(f"P-value: {p_value}")

# Interpret the results
alpha = 0.05
if p_value > alpha:
    print("The sample looks Gaussian (fail to reject H0)")
else:
    print("The sample does not look Gaussian (reject H0)")


# Perform Shapiro-Wilk test
statistic, p_value = stats.shapiro(X['Specific Humidity (Mass fraction)'])

# Print the results
print("Shapiro-Wilk Test:")
print(f"Test Statistic: {statistic}")
print(f"P-value: {p_value}")

# Interpret the results
alpha = 0.05
if p_value > alpha:
    print("The sample looks Gaussian (fail to reject H0)")
else:
    print("The sample does not look Gaussian (reject H0)")


# Perform Shapiro-Wilk test
statistic, p_value = stats.shapiro(X['Temperature (k)'])

# Print the results
print("Shapiro-Wilk Test:")
print(f"Test Statistic: {statistic}")
print(f"P-value: {p_value}")

# Interpret the results
alpha = 0.05
if p_value > alpha:
    print("The sample looks Gaussian (fail to reject H0)")
else:
    print("The sample does not look Gaussian (reject H0)")


# Perform Shapiro-Wilk test
statistic, p_value = stats.shapiro(X['Wind_f_inst (m/s)'])

# Print the results
print("Shapiro-Wilk Test:")
print(f"Test Statistic: {statistic}")
print(f"P-value: {p_value}")

# Interpret the results
alpha = 0.05
if p_value > alpha:
    print("The sample looks Gaussian (fail to reject H0)")
else:
   print("The sample does not look Gaussian (reject H0)")

# Perform Shapiro-Wilk test
statistic, p_value = stats.shapiro(X['Air Pressure (Pa)'])

# Print the results
print("Shapiro-Wilk Test:")
print(f"Test Statistic: {statistic}")
print(f"P-value: {p_value}")

# Interpret the results
alpha = 0.05
if p_value > alpha:
    print("The sample looks Gaussian (fail to reject H0)")
else:
    print("The sample does not look Gaussian (reject H0)")


correlation_matrix = X.corr()
plt.figure(figsize=(10, 8))
sns.heatmap(correlation_matrix, annot=True, cmap='coolwarm', fmt=".2f")
plt.title('Correlation Matrix')
plt.show()

# Step 2: Split the dataset into training and testing sets
X_train, X_test, Y_train, Y_test = train_test_split(X, Y, test_size=0.2, random_state=42)

# Perform multivariate multiple linear regression separately for each dependent variable
for col in Y_train.columns:
    model = sm.OLS(Y_train[col], sm.add_constant(X_train)).fit()
    print(f"Dependent Variable: {col}")
    print(model.summary())
    print("")


# Assuming X_train and Y_train are your training data for independent and dependent variables respectively

# Standardize the features
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)

# Set the alpha value for Ridge regression
alpha = 1.0  # You can adjust this parameter based on your requirement

for col in Y_train.columns:
    # Fit the Ridge regression model
    ridge_model = Ridge(alpha=alpha)
    ridge_model.fit(X_train_scaled, Y_train[col])

# Predictions
y_pred = ridge_model.predict(X_train_scaled)

# Calculate R-squared
r2 = r2_score(Y_train[col], y_pred)

print(f"Dependent Variable: {col}")
print("Intercept:", ridge_model.intercept_)
print("Coefficients:", ridge_model.coef_)
print("R-squared:", r2)
print("")

# Calculate R-squared
# Predictions
y_pred = ridge_model.predict(X_train_scaled)
r2 = r2_score(Y_train, y_pred)
print("R-squared:", r2)

